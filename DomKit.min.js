/**
 * DomKit - A minimalist front-end renderer with component support
 * Version: v1.0.0
 */
const DomKit=function(){let e=(e,t={},r=[])=>{null==e&&(console.error("Tag cannot be null/undefined"),e="div");let n=Array.isArray(r)?r.filter(e=>null!=e):null!=r?[r]:[];return{tag:e,props:t,children:n}},t=(e,t)=>{if(e.props?.key!==t.props?.key)return!0;if(null===e||null===t)return e!==t;if(typeof e!=typeof t)return!0;if("string"==typeof e||"number"==typeof e)return e!==t;if(!e.tag||!t.tag||e.tag!==t.tag)return!0;let r=Object.keys(e.props||{}),n=Object.keys(t.props||{});if(r.length!==n.length)return!0;for(let o of r)if(!o.startsWith("on")){if("style"===o&&"object"==typeof e.props[o]&&"object"==typeof t.props[o]){let i=Object.keys(e.props[o]),l=Object.keys(t.props[o]);if(i.length!==l.length)return!0;for(let s of i)if(e.props[o][s]!==t.props[o][s])return!0}else if(e.props[o]!==t.props[o])return!0}return!1},r=(e,t,r)=>{if(!e||!(e instanceof HTMLElement)){console.error("Invalid element passed to updateProps");return}t.ref&&"function"==typeof t.ref&&t.ref(e),Object.keys(r).forEach(n=>{if(n.startsWith("on")&&(!t[n]||r[n]!==t[n])){let o=n.substring(2).toLowerCase();e._events&&e._events[o]&&(e.removeEventListener(o,e._events[o]),delete e._events[o])}}),Object.keys(t).forEach(n=>{if(n.startsWith("on")||r[n]!==t[n]){if(n.startsWith("on")){let o=n.substring(2).toLowerCase();e._events||(e._events={}),e._events[o]&&e.removeEventListener(o,e._events[o]),e._events[o]=t[n],e.addEventListener(o,t[n])}else if("style"===n&&"object"==typeof t[n]){let i=t[n],l=r[n]||{};Object.keys(l).forEach(t=>{i[t]||(e.style[t]="")}),Object.keys(i).forEach(t=>{l[t]!==i[t]&&(e.style[t]=i[t])})}else"className"===n?e.setAttribute("class",t[n]):e.setAttribute(n,t[n])}}),Object.keys(r).forEach(r=>{t[r]||r.startsWith("on")||"style"===r||e.removeAttribute(r)})},n=(e,i,l,s=0)=>{if(!e||!(e instanceof Node)){console.error("Invalid parent node");return}let p=null;if(i&&"object"==typeof i&&i._customRender&&(p=i._customRender(l)),!l){e.appendChild(o(i)),p&&p();return}if(!i){e.removeChild(e.childNodes[s]);return}if(t(i,l)){e.replaceChild(o(i),e.childNodes[s]),p&&p();return}if("string"==typeof i||"number"==typeof i){p&&p();return}r(e.childNodes[s],i.props||{},l.props||{});let a=i.children?i.children.length:0,f=l.children?l.children.length:0;for(let u=0;u<Math.max(a,f);u++)n(e.childNodes[s],i.children&&u<a?i.children[u]:null,l.children&&u<f?l.children[u]:null,u);p&&p()},o=e=>{if(null==e)return document.createTextNode("");if("string"==typeof e||"number"==typeof e)return document.createTextNode(e);if("function"==typeof e.tag){let t=e.tag(e.props||{});return o(t)}let n=document.createElement(e.tag);e.props&&(r(n,e.props,{}),e.props.ref&&"function"==typeof e.props.ref&&e.props.ref(n));let i=Array.isArray(e.children)?e.children:e.children?[e.children]:[];return i.forEach(e=>{null!=e&&n.appendChild(o(e))}),n},i=(e,t)=>{if(!t){console.error("Render failed: no container provided");return}if("string"==typeof t){let r=document.querySelector(t);if(!r){console.error(`Container not found: ${t}`);return}t=r}if("undefined"!=typeof MutationObserver&&!t._observer)try{t._observer=new MutationObserver(()=>{t._externallyModified=!0}),t._observer.observe(t,{childList:!0,subtree:!0,attributes:!0,characterData:!0})}catch(i){console.warn("MutationObserver setup failed:",i)}t._externallyModified&&(t._vdom=null,t._externallyModified=!1),t._vdom?(n(t,e,t._vdom,0),t._vdom=e):(t.innerHTML="",t.appendChild(o(e)),t._vdom=e)},l=(e,t,r)=>{let n="string"==typeof r?document.querySelector(r):r;if(!n){console.error(`Container not found: ${r}`);return}let o=DomKit.createState(t),i=()=>{let t=e(o.getState(),o.setState.bind(o));DomKit.render(t,n)};return o.subscribe(i),i(),{getState:o.getState,setState:o.setState}},s=t=>r=>{try{return t(r)}catch(n){return console.error("Component render error:",n),e("div",{className:"error"},["Component error"])}},p=(t,r,n="replace")=>{"string"==typeof r&&(r=document.querySelector(r));let i="function"==typeof t?e(t):t,l=o(i);switch(r._injected||(r._injected=[]),n){case"append":r.appendChild(l),r._injected.push(i);break;case"prepend":r.insertBefore(l,r.firstChild),r._injected.unshift(i);break;default:for(;r.firstChild;)r.removeChild(r.firstChild);r.appendChild(l),r._injected=[i]}return l},a=(r,n,i=0)=>{"string"==typeof n&&(n=document.querySelector(n));let l="function"==typeof r?e(r):r;if(!n._injected||!n._injected[i])return p(l,n,"append");let s=n._injected[i];if(s&&!t(l,s))return n.children[i];let a=n.children[i];if(!a)return p(l,n,"append");let f=document.createElement("div"),u=o(l);return f.appendChild(u),n.replaceChild(u,a),n._injected[i]=l,u},f=(e={})=>{let t=[],r={...e},n=[],o=()=>{t.length>0&&(r={...r,...Object.assign({},...t)},t=[],n.forEach(e=>e(r)))},i=e=>{t.push(e),requestAnimationFrame(o)},l=()=>({...r}),s=e=>(n.push(e),()=>{let t=n.indexOf(e);t>-1&&n.splice(t,1)}),p=()=>{n.length=0};return{getState:l,setState:i,subscribe:s,cleanup:p}},u=(e,t={})=>{let r=f(t),n=null,o=t=>{let{getState:o,setState:i}=r,l=e({...t,state:o(),setState:i});return n=l,l};return o.getState=r.getState,o.setState=r.setState,o.subscribe=r.subscribe,o.forceUpdate=e=>{e&&n&&DomKit.render(n,e)},o},d=(e,t,r)=>{let n=f(e),o=null,i=()=>{o=t(n.getState(),n.setState),DomKit.render(o,r)};return n.subscribe(i),i(),n},c=(e={})=>{void 0===e.value&&(e.value=""),"function"!=typeof e.onChange&&(e.onChange=()=>{});let{value:t,onChange:r,...n}=e,o=null,i=e=>{r&&r(e.target.value,e)},l=DomKit.h("input",{...n,value:t||"",onChange:i,ref(e){o=e}});return l._customRender=()=>{let e=document.activeElement===o,t={start:o?o.selectionStart:0,end:o?o.selectionEnd:0};return()=>{e&&o&&(o.focus(),o.setSelectionRange(t.start,t.end))}},l},h=(t,r)=>{if("function"!=typeof t)return console.error("DomKit.memo: First argument must be a component function"),t;let n=null,o=null;return (i={})=>{let l=!r||r(n,i);if(!o||l)try{o=t(i),n=i}catch(s){return console.error("DomKit.memo: Component render error:",s),e("div",{className:"error"},["Component error"])}return o}};return{h:e,render:i,createComponent:s,createApp:l,createState:f,createStatefulComponent:u,useState:d,createInputField:c,memo:h,mount(t,r){i(e(t),r)},inject:(t,r,n)=>p("function"==typeof t?e(t):t,r,n),updateInjected:(t,r,n)=>a("function"==typeof t?e(t):t,r,n),append:(t,r)=>p("function"==typeof t?e(t):t,r,"append"),prepend:(t,r)=>p("function"==typeof t?e(t):t,r,"prepend")}}();